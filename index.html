<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bank Card Maker</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cropper CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    
    <style>
        /* --- Modern CSS Variables --- */
        :root {
            --bg-color: #f0f4f8;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --input-bg: #f8fafc;
            --border-color: #e2e8f0;
            --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
            --radius-lg: 24px;
            --radius-md: 16px;
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --input-bg: #334155;
            --border-color: #475569;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: 'Prompt', sans-serif;
            background: var(--bg-color); margin: 0; padding: 20px;
            display: flex; justify-content: center; min-height: 100vh;
            color: var(--text-color); transition: all 0.3s ease;
        }

        .container { 
            width: 100%; max-width: 440px; 
            display: flex; flex-direction: column; gap: 20px;
        }

        /* --- Header --- */
        .app-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 5px;
        }
        .app-title { 
            font-size: 24px; font-weight: 800; 
            background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 0; letter-spacing: -0.5px;
        }
        .theme-btn {
            background: var(--card-bg); width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-sm); cursor: pointer; color: var(--text-color);
            transition: 0.2s;
        }
        .theme-btn:active { transform: scale(0.9); }

        /* --- Accordion Styles (NEW) --- */
        .accordion-header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 15px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm); cursor: pointer;
            transition: 0.2s; user-select: none;
        }
        .accordion-header:active { transform: scale(0.98); }
        .accordion-title {
            font-size: 14px; font-weight: 600; color: var(--text-color); margin: 0;
            display: flex; align-items: center; gap: 10px;
        }
        .accordion-icon {
            color: var(--text-color); opacity: 0.6; transition: transform 0.3s ease;
        }
        .accordion-content {
            max-height: 0; overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
            opacity: 0; margin-top: 0;
        }
        /* Open State */
        .accordion-content.open {
            max-height: 500px; /* Arbitrary large height */
            opacity: 1; margin-top: 10px;
        }
        .accordion-header.active .accordion-icon { transform: rotate(180deg); }

        /* --- 1. Bank Grid (Inside Accordion) --- */
        .bank-grid-wrapper {
            background: var(--card-bg); padding: 20px; border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }
        .bank-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; 
        }
        .bank-item {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            cursor: pointer; position: relative;
        }
        .bank-icon {
            width: 55px; height: 55px; border-radius: 18px;
            background: var(--bg-color); padding: 8px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        .bank-icon img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        .bank-item span { 
            font-size: 11px; font-weight: 600; opacity: 0.7; transition: 0.3s;
        }
        
        /* Active State */
        .bank-item.active .bank-icon {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.15);
            background: #fff;
            border-color: currentColor; 
        }
        .bank-item.active span { opacity: 1; font-weight: 700; color: var(--text-color); }

        /* --- 2. Inputs --- */
        .input-section { display: flex; flex-direction: column; gap: 12px; }
        .section-label { font-size: 14px; font-weight: 600; color: var(--text-color); opacity: 0.7; margin-bottom: 8px; padding-left: 5px; display: block; }
        .input-group { position: relative; }
        .input-box {
            width: 100%; padding: 16px 20px 16px 50px;
            background: var(--card-bg); border: 2px solid transparent;
            border-radius: var(--radius-md); color: var(--text-color);
            font-family: 'Sarabun', sans-serif; font-size: 16px; font-weight: 500;
            box-shadow: var(--shadow-sm); transition: 0.3s;
        }
        .input-box::placeholder { color: var(--text-color); opacity: 0.4; }
        .input-icon {
            position: absolute; left: 18px; top: 50%; transform: translateY(-50%);
            color: var(--text-color); opacity: 0.5; font-size: 18px; pointer-events: none;
        }
        .input-box:focus {
            border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            background: var(--card-bg);
        }

        /* --- 3. Card Preview --- */
        .card-preview-container { perspective: 1000px; margin-top: 10px; }
        .slip-wrapper {
            background-color: #fff; padding: 25px; border-radius: 20px;
            box-shadow: var(--shadow-lg); 
            position: relative; overflow: hidden; 
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; height: 60px; }
        .bank-logo-group { display: flex; align-items: center; gap: 14px; }
        .bank-logo-img { width: 52px; height: 52px; object-fit: contain; }
        .bank-info h1 { margin: 0; font-size: 24px; font-weight: 800; line-height: 1; letter-spacing: -0.5px; }
        .bank-info p { margin: 4px 0 0 0; font-size: 12px; color: #94a3b8; font-weight: 600; font-family: 'Sarabun', sans-serif; }
        
        .qr-box {
            width: 64px; height: 64px; border: 2px dashed #cbd5e1; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: #94a3b8; background: #f8fafc;
            overflow: hidden; position: relative; cursor: pointer; transition: 0.2s;
        }
        .qr-box:hover { border-color: #3b82f6; color: #3b82f6; }
        .qr-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .qr-box i { font-size: 22px; margin-bottom: 2px; }
        .qr-placeholder { display: flex; flex-direction: column; align-items: center; pointer-events: none;}
        
        .card-row { display: flex; align-items: center; margin-bottom: 18px; gap: 12px; }
        .card-label {
            padding: 5px 10px; border-radius: 6px; color: white;
            font-size: 11px; font-weight: 700; text-transform: uppercase; flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card-number { font-size: 26px; font-weight: 700; color: #334155; letter-spacing: 0.5px; font-family: 'Sarabun', sans-serif; }
        .card-name-bar {
            padding: 12px; text-align: center; color: white;
            font-size: 18px; font-weight: 700; text-transform: uppercase;
            border-radius: 12px; width: 100%;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* --- 4. Buttons --- */
        .action-bar { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; margin-bottom: 40px; }
        .btn-download {
            width: 100%; padding: 16px; border: none; border-radius: var(--radius-md);
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%); 
            color: white; font-size: 16px; font-weight: 700;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            cursor: pointer; box-shadow: 0 8px 20px -4px rgba(37, 99, 235, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-download:active { transform: scale(0.98); box-shadow: 0 4px 10px -2px rgba(37, 99, 235, 0.4); }
        .btn-reset {
            background: transparent; border: none;
            color: #ef4444; font-size: 14px; font-weight: 600;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            cursor: pointer; padding: 10px; opacity: 0.8; transition: 0.2s;
        }
        .btn-reset:hover { opacity: 1; background: rgba(239, 68, 68, 0.05); border-radius: 8px; }

        /* --- Modals & Utilities --- */
        .upload-btn { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .crop-modal-overlay, .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 5000; backdrop-filter: blur(8px); }
        .crop-modal-content, .modal-content { background: var(--card-bg); color: var(--text-color); padding: 25px; border-radius: 24px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .crop-container { width: 100%; height: 300px; margin-bottom: 20px; background: #000; overflow: hidden; border-radius: 16px; }
        .crop-container img { max-width: 100%; }
        .crop-actions { display: flex; gap: 12px; }
        .btn-crop, .fb-btn-continue { flex: 1; background: #22c55e; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; }
        .btn-cancel, .fb-btn-back { flex: 1; background: #64748b; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; }
        .fb-btn-continue { background: #3b82f6; } .fb-btn-back { background: #f1f5f9; color: #334155; }
        .fb-hint { font-size: 11px; color: #94a3b8; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- 1. Header -->
        <div class="app-header">
            <h1 class="app-title">Bank Card Maker</h1>
            <div class="theme-btn" onclick="toggleTheme()">
                <i class="fas fa-moon" id="themeIcon"></i>
            </div>
        </div>

        <!-- 2. Bank Selector (Accordion Style) -->
        <div>
            <!-- Clickable Header -->
            <div class="accordion-header" onclick="toggleBankGrid(this)">
                <h3 class="accordion-title">
                    <i class="fas fa-university" style="color:#3b82f6;"></i>
                    ဘဏ် ရွေးချယ်ရန် (Bank)
                </h3>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </div>

            <!-- Collapsible Content -->
            <div class="accordion-content" id="bankContent">
                <div class="bank-grid-wrapper">
                    <div class="bank-grid">
                        <div class="bank-item active" onclick="selectBank('kbank')">
                            <div class="bank-icon" style="color: #00a950;"><img src="kbank.png"></div>
                            <span>KBANK</span>
                        </div>
                        <div class="bank-item" onclick="selectBank('scb')">
                            <div class="bank-icon" style="color: #4e2a84;"><img src="scb.png"></div>
                            <span>SCB</span>
                        </div>
                        <div class="bank-item" onclick="selectBank('bbl')">
                            <div class="bank-icon" style="color: #1e3a8a;"><img src="bbl.png"></div>
                            <span>BBL</span>
                        </div>
                        <div class="bank-item" onclick="selectBank('ktb')">
                            <div class="bank-icon" style="color: #00a5e5;"><img src="ktb.png"></div>
                            <span>KTB</span>
                        </div>
                        <div class="bank-item" onclick="selectBank('bay')">
                            <div class="bank-icon" style="color: #fec42d;"><img src="bay.png"></div>
                            <span>BAY</span>
                        </div>
                        <div class="bank-item" onclick="selectBank('ttb')">
                            <div class="bank-icon" style="color: #00569a;"><img src="ttb.png"></div>
                            <span>TTB</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Card Preview (Bottom) -->
        <div class="card-preview-container">
            <div class="slip-wrapper" id="card-canvas">
                <div class="card-header">
                    <div class="bank-logo-group">
                        <img src="" class="bank-logo-img" id="display-logo">
                        <div class="bank-info">
                            <h1 id="display-bank-name" style="color: #00a950;">KBANK</h1>
                            <p id="display-sub-name">ธนาคารกสิกรไทย</p>
                        </div>
                    </div>
                    <div class="qr-box">
                        <div class="qr-placeholder" id="qr-placeholder">
                            <i class="fas fa-qrcode"></i>
                            <span>QR</span>
                        </div>
                        <img id="display-qr" src="">
                        <input type="file" class="upload-btn" accept="image/*" onchange="handleQR(this)">
                    </div>
                </div>

                <div class="card-row">
                    <div class="card-label" id="display-label" style="background: #00a950; color: white;">KASIKORNTHAI</div>
                    <div class="card-number" id="display-num">000-000-0000</div>
                </div>

                <div class="card-name-bar" id="display-name" style="background: linear-gradient(90deg, #00a950 0%, #007a37 100%); color: white;">
                    NAME HERE
                </div>
            </div>
        </div>
        
         <!-- 4. Inputs (Middle) -->
        <div>
            <span class="section-label">အချက်အလက်များ</span>
            <div class="input-section">
                <div class="input-group">
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" class="input-box" id="in-name" placeholder="အမည် (Name)" oninput="update()">
                </div>
                <div class="input-group">
                    <i class="fas fa-credit-card input-icon"></i>
                    <input type="tel" class="input-box" id="in-num" placeholder="အကောင့်နံပါတ် (000-000-0000)" maxlength="12" oninput="formatNum(this)">
                </div>
            </div>
        </div>

        <!-- 5. Actions -->
        <div class="action-bar">
            <button class="btn-download" onclick="download()">
                <i class="fas fa-cloud-download-alt"></i> 
                <span>ပုံသိမ်းမည် (Save Image)</span>
            </button>
            
            <button class="btn-reset" onclick="resetAll()">
                <i class="fas fa-redo-alt"></i> အသစ်ပြန်စမည် (Reset)
            </button>
        </div>

    </div>

    <!-- Modals (Same as before) -->
    <div class="crop-modal-overlay" id="cropModal">
        <div class="crop-modal-content">
            <h3 style="margin-top:0;">Crop QR Code</h3>
            <div class="crop-container"><img id="image-to-crop" src=""></div>
            <div class="crop-actions">
                <button class="btn-cancel" onclick="closeCropModal()">Cancel</button>
                <button class="btn-crop" onclick="cropImage()">Crop</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="fbModal">
        <div class="modal-content">
            <h3 style="color:#3b82f6; margin-top:0;"><i class="fab fa-facebook"></i> Browser Warning</h3>
            <p style="font-size:14px; opacity:0.8;">Facebook App တွင် Download မရနိုင်ပါ။ Chrome ဖြင့်ဖွင့်မည်။</p>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
                <button class="fb-btn-back" onclick="closeFbModal()">Back</button>
                <button class="fb-btn-continue" onclick="forceOpenChrome()">Continue</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script>
        // --- Theme Logic ---
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                icon.classList.remove('fa-sun'); icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.classList.remove('fa-moon'); icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        }
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') { document.body.setAttribute('data-theme', 'dark'); document.getElementById('themeIcon').classList.replace('fa-moon', 'fa-sun'); }

        // --- Toggle Bank Grid Logic (NEW) ---
        function toggleBankGrid(headerElement) {
            const content = document.getElementById('bankContent');
            content.classList.toggle('open');
            headerElement.classList.toggle('active');
        }

        // --- Bank Data ---
        const banks = {
            kbank: {
                name: 'KBANK', sub: 'ธนาคารกสิกรไทย', logo: 'kbank.png',
                color: '#00a950', gradient: 'linear-gradient(90deg, #00a950 0%, #007a37 100%)',
                labelColor: '#00a950', labelText: 'KASIKORNTHAI'
            },
            scb: {
                name: 'SCB', sub: 'ไทยพาณิชย์', logo: 'scb.png',
                color: '#4e2a84', gradient: 'linear-gradient(90deg, #4e2a84 0%, #7d4198 100%)',
                labelColor: '#4e2a84', labelText: 'SCB EASY'
            },
            bbl: {
                name: 'BBL', sub: 'ธนาคารกรุงเทพ', logo: 'bbl.png',
                color: '#1e3a8a', gradient: 'linear-gradient(90deg, #1e3a8a 0%, #1565c0 100%)',
                labelColor: '#1e3a8a', labelText: 'BANK NUMBER'
            },
            ktb: {
                name: 'KTB', sub: 'ธนาคารกรุงไทย', logo: 'ktb.png',
                color: '#00a5e5', gradient: 'linear-gradient(90deg, #00a5e5 0%, #008dc9 100%)',
                labelColor: '#00a5e5', labelText: 'Krungthai'
            },
            bay: {
                name: 'BAY', sub: 'ธนาคารกรุงศรีอยุธยา', logo: 'bay.png',
                color: '#fec42d', gradient: 'linear-gradient(90deg, #fec42d 0%, #f57f17 100%)',
                labelColor: '#fec42d', labelText: 'KRUNGSRI'
            },
            ttb: {
                name: 'ttb', sub: 'ธนาคารทหารไทยธนชาต', logo: 'ttb.png',
                color: '#00569a', gradient: 'linear-gradient(90deg, #00569a 0%, #f37021 100%)',
                labelColor: '#00569a', labelText: 'ttb touch'
            }
        };

        let currentBank = 'kbank';
        let cropper;

        window.onload = function() {
            selectBank('kbank');
            const params = new URLSearchParams(window.location.search);
            if (params.get('name')) { document.getElementById('in-name').value = decodeURIComponent(params.get('name')); update(); }
            if (params.get('num')) { document.getElementById('in-num').value = decodeURIComponent(params.get('num')); formatNum(document.getElementById('in-num')); }
            if (params.get('auto') === 'true') { setTimeout(() => { generateAndDownload(); window.history.replaceState({}, document.title, window.location.pathname); }, 1000); }
        };

        function selectBank(bankKey) {
            currentBank = bankKey;
            const config = banks[bankKey];
            
            document.querySelectorAll('.bank-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.bank-item[onclick="selectBank('${bankKey}')"]`).classList.add('active');

            document.getElementById('display-bank-name').innerText = config.name;
            document.getElementById('display-bank-name').style.color = config.color;
            document.getElementById('display-sub-name').innerText = config.sub;
            
            const logoEl = document.getElementById('display-logo');
            logoEl.src = config.logo;
            logoEl.onerror = function() { this.src = 'logo.png'; };

            document.getElementById('display-label').innerText = config.labelText;
            document.getElementById('display-label').style.background = config.color;
            document.getElementById('display-name').style.background = config.gradient;
            
            if(bankKey === 'bay') {
                document.getElementById('display-label').style.color = '#4e3b31';
                document.getElementById('display-name').style.color = '#4e3b31';
            } else {
                document.getElementById('display-label').style.color = 'white';
                document.getElementById('display-name').style.color = 'white';
            }
            
            // Optional: Close grid after selection
            // toggleBankGrid(document.querySelector('.accordion-header')); 
        }

        function handleQR(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('image-to-crop').src = e.target.result;
                    document.getElementById('cropModal').style.display = 'flex';
                    if (cropper) cropper.destroy();
                    cropper = new Cropper(document.getElementById('image-to-crop'), { aspectRatio: 1, viewMode: 1 });
                };
                reader.readAsDataURL(input.files[0]);
            }
            input.value = ''; 
        }

        function cropImage() {
            if (cropper) {
                const canvas = cropper.getCroppedCanvas({ width: 300, height: 300 });
                document.getElementById('display-qr').src = canvas.toDataURL();
                document.getElementById('display-qr').style.display = 'block';
                document.getElementById('qr-placeholder').style.display = 'none';
                closeCropModal();
            }
        }

        function closeCropModal() { document.getElementById('cropModal').style.display = 'none'; if (cropper) cropper.destroy(); }
        function update() { const val = document.getElementById('in-name').value; document.getElementById('display-name').innerText = val ? val.toUpperCase() : "NAME HERE"; }
        function formatNum(input) {
            let val = input.value.replace(/\D/g, '');
            if (val.length > 6) val = val.substring(0, 3) + '-' + val.substring(3, 6) + '-' + val.substring(6, 10);
            else if (val.length > 3) val = val.substring(0, 3) + '-' + val.substring(3, 6);
            input.value = val;
            document.getElementById('display-num').innerText = val || "000-000-0000";
        }
        function resetAll() {
            document.getElementById('in-name').value = ''; document.getElementById('in-num').value = '';
            update(); document.getElementById('display-num').innerText = '000-000-0000';
            document.getElementById('display-qr').src = ''; document.getElementById('display-qr').style.display = 'none';
            document.getElementById('qr-placeholder').style.display = 'flex';
            selectBank('kbank');
        }

        function download() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            if ((ua.indexOf("FBAN") > -1) || (ua.indexOf("FBAV") > -1)) {
                const name = encodeURIComponent(document.getElementById('in-name').value);
                const num = encodeURIComponent(document.getElementById('in-num').value);
                const target = window.location.href.split('?')[0].replace(/^https?:\/\//, '') + `?name=${name}&num=${num}&auto=true`;
                window.targetIntentUrl = `intent://${target}#Intent;scheme=https;package=com.android.chrome;end`;
                document.getElementById('fbModal').style.display = 'flex';
                return;
            }
            generateAndDownload();
        }

        function generateAndDownload() {
            const el = document.getElementById('card-canvas');
            const originalRadius = el.style.borderRadius; el.style.borderRadius = '0';
            html2canvas(el, { scale: 3, backgroundColor: "#ffffff" }).then(canvas => {
                el.style.borderRadius = originalRadius;
                const link = document.createElement('a'); link.download = currentBank + '-card.png';
                link.href = canvas.toDataURL('image/png'); link.click();
            });
        }
        function forceOpenChrome() { if (window.targetIntentUrl) window.location.href = window.targetIntentUrl; }
        function closeFbModal() { document.getElementById('fbModal').style.display = 'none'; }
    </script>
</body>
</html>

